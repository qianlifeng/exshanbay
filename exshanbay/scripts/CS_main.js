window.onload = function(){
    exec(injectScript);
}

function exec(fn) {
   var script = document.createElement('script');
   script.setAttribute("type", "application/javascript");
   script.textContent = '(' + fn + ')();';
   document.documentElement.appendChild(script); // run the script
   document.documentElement.removeChild(script); // clean up
}


injectScript = function() {
    if(typeof ReviewView != undefined){
        ReviewView.prototype.render_detail= function () {
                stop_spin();
                var review_detail_view = new ReviewDetailView({
                    model: this.model
                });
                review_detail_view.bind('next', this.next, this);
                review_detail_view.bind('prev', this.prev, this);
                inject(this.model.attributes["content_id"]);
        };
    }
    else
    {
        console.log("exshanbay:could not find review view");
    }

    function initLoading(){
	    var img = "<div id='loadingImg' style='text-align:center;padding:10px 0;display:none;'><img src='data:image/gif;base64,R0lGODlhIAAgAMQfAKysrMzMzKSkpGtra9/f356entDQ0NPT0+Li4oeHh8nJyZWVlcXFxba2tsHBwb+/v7u7u93d3Xx8fNbW1tnZ2enp6erq6u3t7ezs7O3t7e7u7uTk5OXl5ebm5uvr6/Dw8CH/C05FVFNDQVBFMi4wAwEAAAAh/wtYTVAgRGF0YVhNUDw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDowMTgwMTE3NDA3MjA2ODExQTJGRkEyMzMyNTVBNjU1QSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpEQ0I0ODhGQUY0MjIxMUUwQTgxMjlCRTNDN0M0RDg5NyIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpEQ0I0ODhGOUY0MjIxMUUwQTgxMjlCRTNDN0M0RDg5NyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZBN0YxMTc0MDcyMDY4MTFCRURDQTlCNjA4NkE3OTg4IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjAxODAxMTc0MDcyMDY4MTFBMkZGQTIzMzI1NUE2NTVBIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+Af/+/fz7+vn49/b19PPy8fDv7u3s6+rp6Ofm5eTj4uHg397d3Nva2djX1tXU09LR0M/OzczLysnIx8bFxMPCwcC/vr28u7q5uLe2tbSzsrGwr66trKuqqainpqWko6KhoJ+enZybmpmYl5aVlJOSkZCPjo2Mi4qJiIeGhYSDgoGAf359fHt6eXh3dnV0c3JxcG9ubWxramloZ2ZlZGNiYWBfXl1cW1pZWFdWVVRTUlFQT05NTEtKSUhHRkVEQ0JBQD8+PTw7Ojk4NzY1NDMyMTAvLi0sKyopKCcmJSQjIiEgHx4dHBsaGRgXFhUUExIREA8ODQwLCgkIBwYFBAMCAQAAIfkECQYAHwAsAAAAACAAIAAABf/gJ46khnxOAwDNo2RkLJPV5Dyes+7NV0CVmZByezwIh91KgUg4ITChyBMwWg8IJYDgcDoFQSFGU7W6PlqNwOtcdGaZAyGjMD80kJ2jw3Y6PhoyEwYGCB4MVgoeHRscERwGfQofFWEjBISEGxYMChtCEwVOBhoVHR0eIxmZmaiBUhkNE6Wnp6+YrAYRUjEatbWpH4Oss7wxpr9vgR4Ew5bGIhnJHRkIEQgWHxkc0DKmFRZjHwQU5dcY3b3RHpUR5e/Z6SO0tRXv7+jy0dPu98H6vpL1KzdH375kCBCgEvEKILJTQTQs2kDghEFxGSx0sMCMgEeP+dJJ61DBQ0MEHz1zWkz3EKKICikrRoGmMVmwDCkRZMjwTIiGkb8awiSwQQOGDRuoCeHZweivfyKQSkRKdUyGnxrokZToMgYMC1Spag2SLMiihiU4hE36IRmlsoCk+ArrAeipjGXRCgGLFO9TDE/ladDYNu8pkwZHWHhYSZuxEAAh+QQJBgAfACwAAAAAIAAgAAAF/+AnjiSHHIHiHJjDUBgpz6P3Bc8D6QbRCAIAg5ChzTAnyyGXgxwivyCgMTGSKpRAIOJxMB8HBEAarCgiVs/BEDAYMMtmhEAGGBCLAoFWmbTdAQQVD14QGwdAQIENEgkLaDIdbH8BBx4UBx0IHhVLUxUQCwmjAhUkHRiXgAETpjQEFBOjswkQNREUHR4EWhEZGlYaCrSjCxwiGxTKCBkVe1YjGg0JjQsQkB+4yhQRFcDQJAIFDr4f3hbb2xbgMgTHnB2oCOkUBN/sIxnx+xYEEbgTcuGT4WFfBw6mLFjgxCHGwHwGO1SIN7HCr4f5OHCItxEBAQIeCdjAKCIDJw+cNrB8XDkSowYPvzLEULmSQAeSHwpurMDT2UoErjBW2Mhx4UcEqDIUeajPYMMMCDG8jIdRH1GqIjBY6LCha1BwHqRujbfugwauXdO2tDJR19QOSz9YSJtWaVwZGobu8/ZSRgW63ih6AIYhw8K8Vzc6JHF2A1CTGzXCJMrBpFOLNM5WLrhv89XAe+/KMPkhYuWx+17uFE0DQ0RUnPnlHTzQMlHDGzdQNIvzg0lTBXlaUAotBAAh+QQJBgAfACwAAAAAIAAgAAAF/+AnjqTFRVulrMFBVGQsi1kWTUZAIUwDQY8HxRLJzGQawiHADEwyjOCjwVACFJ7jyJIhMA25gycgfbgeAkGDoDl6CAhNJACmVwxAiCMSAaTVFDNvFBMdFRNNBocODg0GHAwFAH5qHDFJFJkRHhw5FAQeFgQdEycAkmkAAQgwIxwTmZoeGxwYMRkaHQ5pBY4VDQ5ZH0SxsRVtWhUBAA8EEw0SCwgjGwSEsAhGWiN8AQUJEgkNHxoWHqHWoNsxBgnu7tJvCIYYFcLrIxPv7woVBP8IOCDDN8IDAAnhwAGo9o9AhA4EYzBYUEAAACocGv67F/HDBj4pLHjUiEBkxxG2PMpUqLcBAYINHTpoO5mhAoeYKTJ4wJCB58yOGWLG5GCvQoWhJk/OutmBaIWXG1pCPEnuaFOiGKJq3WCrowYPOlV2sNVh6waO6zQcrVADg4c2FlrCBPtzm4WmMCsk/dCBFU+bb9cFFdp0bEG2KpmynaFBZ02mZfd+0Fm4MFi2PD+I7fDWKtGBItRCzhk3JtuyQikTrUvD5lAM9W6udm1a8+Ijoul5INwh91ULjfHtvgy5t2sORNFuMzIY+U2dN/WCjtjYglGjNbhMjxECACH5BAkGAB8ALAAAAAAgACAAAAX/4CeOo/ZVUXRMLGdRFUbO9Kd5W9UZQcAbiMhDcUB4arTMJkIhaCY93sFjgDQejEMlgxR5CBTKhGIh+KSewONhhUwyptp3HIZVeL0IhwFZQxgRCBRIGWB1FBEeFGcIBA59f00OABEzGhUWFRtiYYmaHR0eOwwNDhMbDAAFDRUkFQQIMRtjBFuWoAEUGwECvQIMMh8YjbAdwxtHXRVpAgUAAAKUIq8E1bUacV0iB73QBQIKNhvWBBEb2jMVDs0ADYAZHsTWHtnoHwQQDmIVDBOXHRsQIODAxR4JQQHWJWiAwYMHeBaCGRxBQMCCBBIkCKjAoQOmhxNJTEhAEuOCDgg20KjkIDEkBYwlT6qc2XIihQUSSEqQOdNIyBG7GqhaUKCCwA2gCv7U0LCDigAWkFp4qHTijQqX4sDLgAGDjqr2MnTg0NHjkQyZxnLAGjJqWaRcLJAt68KqqI5kLYi49NYjNm1X0XKEO8IDXQvwtoAVkUGHC64c9brquMXDpxgfMnCFw5HDBhcNLdSzUSGGV7WhMIDy2LgsKLY1NHt13QGeZ1AYxK7OUXOGarKr+a5GrHZtb0uW1WLlCGrtiY4gDSYOJRYv0oeIf+6l17j0x8UzQgAAIfkECQYAHwAsAAAAACAAIAAABf/gJ46kVyEEYSFTRG1WRs60iG0ERU2URwRAw4Egq9E0GU+Ep6NUfkCgE8ExjjKczqqpWwUMhm+HwAggirRbquJjTqMGCiYAgSiINGyKsDFNmBUbYQoHOA91dgQzGWN7BB0+fBUZGBw5CAh0Dw8NDQEWJBkoexFnlIsYGAgMEIetBlVXFRyjjxpWHxUTDg0OARQ5ESImHhmBCB23uBoaEwwUKAq9GRodGx0VGB7FuCQVYwcNAAUAZ7Qb19zdJBgMAgUC8QYW6OgIFcrrIhkO8ADxD07Uu6dvxoFx7wo0EFjPQ0ESG8RJZGChQgULFjzke5hhiYscGUJSwvCwBIMHDhDKWcT2Dc3DCQsSyJRQgB6Hm5BKfsjAQIKEmQI8ZOlwE1/JCgB8ykwAgFEHaxyMPqygIGaCnwpyZWETcuMyYxMaLJCwgMIHD9gwULLo1YiJWxUCAFj4AUmqiuhidEO7VS2CDSM0oH2K02FbZsY23MzicIbQoU+1scFwK4nFDBaeEt0waYaGWUOLBWLs9Kbom5xJ5vkWVTDRmxYwvOacxFoHl4u+FSOqOcY3zdkud+tqASfR3UMVd31o4mneaoq34tanAQNGrhYzTicRAgAh+QQJBgAfACwAAAAAIAAgAAAF/+AnjiSWaR0RRQSxZSYpz2JWIZuHTDxPVKpKhjazbVoESyVCaU42lUPgEPEQSTfkzxOZNCk3gyJgoGyumkxKy/EQDs1fhGwIBCjWYsXjWasQGAgrFAgVE3Z2Bj8VGjIVG20ZHEgdGhgVmB6GAWMGHRsHBmcjHhw4HXwdHBZDMpIUBhOFBg8QB3koOBsbqBmtNBo3KQYQEA0OBCI6ujh5VyMVxBC1th7BHBs4CB2/zx9RxcXHZxkeSh2o3jIIDg0PDg4BCOYeMPWN6qQHChMrLhYcOGCygC+fCA3Luox5FBBdN4MeFDRoAEAAgAoc0GV8mA9BgwUFBBS4iG5XBwwGSdp4DFnxYsYOmAqm5FBRgEgAlzyY8JVyhAUD7Ww2sIQBgyYhPTNMiBVhnwENFmB+apNSw4QCIx/E6vANkiooHIlEACChbIIFACJ86PNSYNgZGgIkGJAgQVkAXG28rFC03rM0VyXUlbDgAClVQi7BdEYijU4PAQqYbWBhRAYlvjCaxJAGxpA+MD9kCLBAQgG1jS1h1LinTwWYRhoaVQAggEyfqljrxSYEIOu1BBiTuPw10uuGMFRhS6dOEyQYDdHp/MTLAsp85Vh52BUQyiVMJ3p+aHT0dQeCPK+EAAAh+QQJBgAfACwAAAAAIAAgAAAF/+AnjmRmVd2GVBmHdF5GzrSofRVC7ERXRRNKZCWr0TysCm/XsRAm0EmkYixZNpsKZrOseCKU8GHa6RRpmYpqY1byKhVKMFyGdmppBAK78Xi4BAgeHXJhGxYRAQoTHEcdei4rGCcWHhpbBBQEOQYBnhQWJRhIWHosNBpIKBOenQERGDZwGCYpp1UZHQYKnp8eIhgcWX6jN1XABK0TepY4GxwcPmfHIoiaVxMHG7llHdHT1B9ITwoPDxMe0cJZxuEjBOUNEBAGGHBlHKHuJBEOEOYNAmQgVmwfCQQO5EFowGCUBwwQ2xncUM7BgwYOKkRD0SGWQREZEEQAc2CCmmhYfuN9FFcyQiYCFqB5y7cywwQAAgA0aKAgHT4YKzEoKLBAgIACEHJxgPNQYrgKDQrkPBoglYUMA0+Aq6IBAQOcRwFEAOnBwsxbxzB4mmAgaoEHVMSl8PZMpZEMER4kWAAhSMIJIwZF8+YFq1MRHRokGCAhAYAAUux+MPusib0mVz9gxaCBAwAJjUEvaDgjDRYWgtlc1QhDaILXEgYsMLA1TUfbwjj4yU2FgADQEgoEiIsG65XBHDJg6NYng4MEEgQc2FpazTM2o2Yu/UAAAAAK7jQM1Mim7LpvGgLVVDXeRyUZh0WEAAAh+QQJBgAfACwAAAAAIAAgAAAF/+AnjqSGeVhWbVzXVRopz6PmVdxWeQjhEwhPxpKh0TwdhFKH2fwiCEsH6DHWVJulLjP9dTyECYUAMw5Rq022g+kCLZbIRBypFGVYNlb5rfQIXwhiFHMEVTIWOUxIG18ZGR4WFRgVcmJiQXciSC4ukyeaJGAUpIAVPocaOB0crR2hRxsRZJUGBh0iNhWsLBVWJCorFAEKARFFkB6RL7BWqhMB0QEHdhU7j0K/MxUGxQbRhjnWRNozHhTF0hGJjWoWMeUkgnQROiwdaofxI1wIu0AreH3ZJ4rCNwXFJFmz1qwchwAQGkR0YOIRBgzwCH7Y4EBiRAaQ4FjTty9DhAceG9MEoNRui8YPFSYo6NjAAJcWikhqU0VByTAHFFS5aqHzVwUGABwcIBAhAi4PWTjsSJHxlwEACwoAeBCAgAgsdlQ40tYBQoECAgQUaEDhDgYiQ1zZmZFhAzSZAATkLfAAVw2WAoUIKeIhAIAEC4A6ULvWawkPOVwwScThHQEAEgZIKBCAQgOtB5qpaMUiRRpcBARIkJAgAYAJB5QW/ZpmEidWGiwcbq0ZgFMMv3J3sHCDRQ5lDVavTtBgw74ULNVsSPEgweYGBxA0dPbW2sAJEicANxICACH5BAkGAB8ALAAAAAAgACAAAAX/4CeO5JdZVZpimueVcNxmXofcyOZZecXGMU+l47PlEB1Mh8BEZoAjWmez6dCo1EqGwyRECBXoR2PhdDpml3FT8Wy6BES7oollhujzfIPcIbpyFX9hJRgYQlMbHFo0HhgZGTYRchkbFBMELyMYK1JsGHYei24UlxQITyYVihaPFhapQJAdppcRdB81ikQesWIfHKYTBxQbGhqrZnxavyMeBKUUX2F3ZhxUHnXNYxVMRKthO3jM2yJkZ9AHEZCQLqDlzhETBgoKE0IVFi7a8B8d9AECKDhQgYM1H/1E/GMQwEAAgtYUaepXYUJAgQaSJZoIL5IXCgcmCNpFDh6yaTY43dRoY8jXNg8UFDAMyWEGJBQuxVRi0KABBAgOKJjAp6jkrwwTej6A0MABgQ9KqEzpYKGcBQIMfvrMqGpXFVxiKhwIwMQAU6faalzj0GpHBn4mRCBgAEAAAyYBHnA1t4qNpyQtQBqgwEGBgAIL7EqbsKFEJJYFFT06ICBBAgAOBWjWDIFCVRiGhJiZ8tZBggEDFjBIWkDzggYT4BayoYgDpAYSJFhuEMFBgdYNDnCE0SKRFQICdCeQsGAsAAAOIpSTEobCggG5ByR4EMHABA79NGQAFQHAgt8CML/IKSIEACH5BAkGAB8ALAAAAAAgACAAAAX/4CeOpJZ5lnVWlYVlZCyTGMttnVchCF55mpnQVMHdOhkLb8OrZDIY4Ujj8dQ6HU7H6dlsOAgO6uuRJrXW4jdnYfacHAJBPMtUOjjPCc+pYDwdPDkeCHIEG2UlgF99aS0wVCxVcXIRc0FTFRxaN04mMiZdhnJIJCtZXk5SH3YEln0sFiInLxZ3qqsfGng/hBEIGRq3VlUwubMYFnEUExQqmlo/mMezG8zXiFl4G7jUrAQTzcwEangIFdPUGhzXEwfkXpt03iMVEfcRFAgoVVXp3na23HryBEMUelMCFSKwjwWLUgg/VJhgwECAABPafMkTMQOBAAwuKjjg4Uinf7ky4kQIoMBigAgYUH1BhzBDBwoHWAYgYPNNMXqEDoELYICDxC0vdAA5loECywl4LJU50W9bIjMUHDRo4CAAhQ3GWOnAQoaIHhIpKhjYCqEBBAYE0nVBoE2DhQBuDQDjMIEBg3sMILRtwABBDDteuH2IIECChAV/HQAoUCDAhgkPtjKgcNBUESQeHCQYMEBCgwMQCixY0MASA8IwhdQAcqCAhAS4G1B4IKC3AAcRcsY288ECBAmlHQOI8GBB7wUADHALu6qCgwUJkA8AsHtBAQEAHkRAaQaBAQUNBLB2KvhlB/IfQgAAIfkECQYAHwAsAAAAACAAIAAABf/gJ46kZmJWpVoe6b5lhlVWZnFct20VWmuwl8ZT0XU8nk6Hs0NyEB0LMDgi7niZTGWnzHg2CASnkqF+NJYl7qjdjWdXBBbmxcyWu15RiazIwRw1MEQ9M0xYGnYZGlphYn0VLSOGb4QWGDBpPB4ZHQQEHSNtOW9ZU3RIaZ8ECJgfX2JPHJJmIlqrnx1lSYdQrrVnnqsRrYwYhFGnwB4EEawEHDIeGFl2ysCdPCmXaR00UsAvXix+Y245ZeEkGRvNERMRFWtz6iMWEQcTFPo6Vx2/9e5N0AdPxxgV18Ldo7DvQIRtdgDWw9Auwj4C0rxESlgrjYonHdCo6CfRjIYODInabdD1wc/KDbPqVZigIIBNhy2+wByTLlyFAwxqKlBAoUWblR8yRDAQgdYLQkttBjCwQQQab4smAFggIEAoZR4QTDhAYQOFADUj9JTxyoCABAMGFDggLxcGCg4gQFAAZUKACaFGTDlQQILhAQv+QmjQgAGCA4wbQAjAiljPER0gSBggIYEEAQYUbF0AIEKEB5IbPKDKKVOAt5slNDgtoADpsgoiN/BqpsLpBQMSOKCwVYBxyrkbOKB8OYiHAwAAGHC7oID1B0sdGCBQgWMQBGUpPIgenQEBMOBghAAAIfkECQYAHwAsAAAAACAAIAAABf/gJ46klnmeZWEZ5mYaKc9f/HlVx22bhXeViiVDK2I8GYuO10FVOLtNhVgcaXAVD+YJ7WQyXF72WwV3Npzpk6ntIDYdrydOlYF5nDjqjGjO2RoVCH11I3dwYidCSFc5WUqDUjYiX1t8kjUlJidnPG8WhipfOHAYVSIYbm9vUyIeUBUuR4VFYJEdPiKBeEC0p2BCilOvaDpepzMaGBYVGwQIQW88mMgyHs4E2bhxORyg1TIW2eMcR1opk+CuBBHZEQjLLkjq1gjP2dBpjr7VjcxAguC88UDPUI4UQpqhkWKq4AcOESi0i7CBWMWGBTMgmHBggkcCWIgAS4fMQwSPFDzcbqCiMUCDBhRIVvHALuWECBVEbFAAYIEECQAIVAOTB+JHIh0eJPg5YECCAASrVIjQEVqFbDk/bGggwenSBQoINMGoKwOBAAwCHKAAZwiqCQB+SkgA4EAACAwOdNDgRttZBQEUKJiwwQ4FAU0LGDjQoEABAAY2GHjgQAGFjQECM4gs08CCBQ4iOBBQYIFiAg4AvDRwNbBaeDQsoJ0QQMAC0gAIK2gAoQGDZwYCEJY5AgcCBqUd5ybA4CVvAwgiciBu+AEA3Gut84ZgoMMRehg4UAhAWaKCymoJUP8QAgAh+QQJBgAfACwAAAAAIAAgAAAF/+AnjuSXYVlmVZWHlnCsnWuLVRy3cVWmabEgprMpcly44qblsXgyQVLGw0FsOp1eZcfpeDw4LyY6fW5zy5uyd8thoTANrpfZIhA9S8fao+r4QCQaFjocFlNbHRYmTRUYYFY6inAickpXjk0egSI+lphTTiMZe0UdXZRBKixmO3B1WJIeUSUnYBwECIuMjxVZqbQmWxt3HSksKI/AwVR3xBtfRSw9wTCkzlYrVkTQ1TA3WcgVkVaz3oLKyjhdLcvVg1imKe7nJhsE+LnC4wRj9SIeCETIhyACgwYNAABQsKteBYECI2xwkEBCxQEFKPz7MIRYhAgdHEgYcFFCAHoxMN6saEKsAgUBEmJKWBDAX7WAA1tUsDBDJMkFECZs8KaBA4UDEwYiMDehYgEGBwI4OIAA5YeAE7JmjVBBxIaEASIEaCBAgAMEH36QAMNCIAUKWQmYy1BwggMBBRYsADChwkAvGjpQMDABD4EJSCM0FIHBgIAFBfI2iEDBwYMAFDpEUMAAc5YIEzLHmQAgcgEABjgYQNgggMAACgJ4JmYsRoUDDSRTQKAAAoQGCu4ZkN1ZcYooGAg4AODgKOsGDO7Ank7A6ogOSQkoeN6cwPADEitwCubD5XAGDlxrjsABZQgAIfkECQYAHwAsAAAAACAAIAAABf/gJ47kp3mVZVVelmFuKcuu2yFbXmEoq81ATKXTqiAQHc7Okuz4gCNhR5fxcDgdZ2aYQ2agny0u18FgpgiOxTPl6Fq/GWp8XZI97Jwan/qWqihtSi8pHmEVG14ZFlctJGc7i24VfnEiVX0odRZxGTccHmZ9UBoueW4bHX4eiVhEfmAiVmM4hlt6RxWxJFtXTjthgb6GuyNbPniwPzXFvHhsaggREZSwzZdMHAgEHQ0FAg0OB8TXH7NHSAsDEgkJBRPlsts4SAXrEusM1sW3iUgA9/Lt26VByBAlAAe0AwAvXhULL1o0SLAAwIMACOJpQLQBCyUDFydMMBBgQzkL2wjZqESAh4ABBRAAAHCQsZiGDtNURmD5IYK3AgUWCAgwcIYYndxEUACwAGhTBRCLmrCiZAiBncQ2OAD67UEEAhMIeLA0wgMCChRYWuFmiQCEpg8IbAgQjkIHDYyIYDh74ACFDRUCYyChYUKDBgc2THgAoAEDuxEMGKB2VqRIAhXIyprg98CDBhAaPKBA4IADBokrRLA8gRqQRREcND7MIBHJAAEIWCh9oLUqMB1MH24QoAMB3AEUHLiBVrdmOS4dPDiAYIKC6wwMIBhCpJzqtB0oGOg9wa6I5yJCAAAh+QQJBgAfACwAAAAAIAAgAAAF/+AnjqOWZZ7lnVWFZZpGzrSYWV3HbdW9IZ0Wpkb8oDqIza/n+Sk7K1hRpPFYK0olk8PRuTwVy5CYwULL3K51t+mIK7keTYOpIIAvzy6H8SB5VjpaGTM+SUFXFSsmLYp1GztJHnNYSngmJCaEGB1ZajIfJi8fYDsVoGR2QFaLHxsBDgYVNitTNi0edLgfBwUJCw8Rs7YkGRjHODwaAQkDEgsCAYTEJclcigwSEs0DAB3UJVgIbBUAzhID3RvgI35ZCBUFzgnbDJPsRi1Bbg0CAAANGBDAN6IPDA8YIhygMOFAhDEEMagA44ECAwYOHDDgQJBUBS4/OjAoAK0AAAMQweKpukOgg4MFC0gugPANn4U7P+AFEFCAZIEHNcHpirTBQwQA0AJSUCSUFQ4gZRwIgEChA4EDE4ZNKaOljyIZEQJMQEAgQAOqFqZoqECg7Tg5VDZQgAWhQQMFBGBIoXIiw4YIbdtuSOnhQAOAdhlEsLr4oFV4dtoCHpyJAAO7Zw8gCKvgAAe2DCcUZRshAgILqGxEuBwwyQQFDgK0JNBwAgEVm08TwWCRgeewAYLfJkCBIQXIHNIW8UDANAEDCgJEj2BB4YSGFDicAJcBwYHgDBQstU4BsHJ2FjY0b0jgo2AXRUIAACH5BAkGAB8ALAAAAAAgACAAAAX/4CeO5KdlVtVVlYVpZimXp9faG7JtnIdhlsxMdrJ0ch2P54j8HSuYYSlTQegqGepug8XkNp3g0Cby7DhJLYcDtZy5HljJY3AcKh8LJ1exdf4WOGArGBlyIwQACQUBUR57WBoeWVlVCGxKgUIiGQoJAxICBx4fSpskGhWQPip9chQFoBIJAhNSnBg+fpBCHA0SoAMDCQG3qBVbOqQRihLAAwsHxiOpOjsIFakGDwACCwsPHdMiGm4IK2EaCAcTFAYBEwjjIyh9GUoaCgANDgF389QyFLrnosE3AQAebABIzYYKNgYLFFgAIAJDTsh4QFwwkZati1R0rKlgEGFCeSBV3l3rwKCBAgoRCJC6KEnFEwIUCFRph4fhvRcY+nSYECCAggYPIhya5rCPqQ5HGzTYd8DCvAwdrGzJ5uHAVKkNDIgbh9WK2Z4IHIBlQGGFmCEngubQOrOCAQgQFERAQIDdhlPUUqzAocMqJwJFI1Toy4AtFA8pDFUhQGCDjyeAMWRFEOGdAgYT/hCIsFdPTMocArmYgQExg6IBKFShMOGA4smUzxkakgEB0c8BIljAWVuxF9IxOwCWoTnCAQUGdNKe3mMD6UtxpmXYALMDh9oTwuvM2mMpUyyLYV6flH1ICAAh+QQJBgAfACwAAAAAIAAgAAAF/+AnjqTmVWiFeVblZWQsf9rWidaGIJtldRuOCzaTRSCOzcejQ3QwmApvs6kQi58MoZFIODwfoDCTqVB5Fgy5WDkAJAOJILLkIDgeDDBojVplGAcFA3ESCwoYH2YdHh4dHByMGhY7FRoxGAoLhXENShkWHhqTKY0dOxwWV4oTDwUJcAMNHCKXtRoZK2Y2NqJZBAEBFAENCwkFBquAdjZCvh0MAgIOBwYBChTKgKc2QzARxQsCEAEEYFgjGlGhUKEaBwILBfMQN+gxuCcVHS4O868LHlS4ty1IJAsMACgsIECBBYIxclChYoGCgQnDAiCwBZFGjikIKkSgEJKHNoInhPQ8qhDAgQIDCjR2JJFLDYtMABo0yBmBY0cTZFZkIKYTwIMIJ9Gd4IcCgwGdOhkQ8Elwkg6DHg48QBJgwoakRTSYuRMJAwIDBiKcqkQVS5lHOlSU4YHAorBz6Go2Gmvp1wS0ChwYsOd2XwVVZf4siRCAwTUFEzqEytDWRBN+jTDY0sBhwmMDBKQQMPkBg488H3fcwSsiQ4cJDCB36BBhAkY8GwgQqOJINQEOJxEcOBCaAIUJByYIQRBB9xMpOxgVyRAXAfLjEVzk1o0glB3F09VZTz4huwfmESI4WaEKoljjxynwM9489Ki2WNSZGX346mzWMoQAACH5BAkGAB8ALAAAAAAgACAAAAX/4CeOovYRjkN8WtVVXkbOtJghEwMkiYN9HQRiU8FgMrLajPNYSAYDCYADFCJgrkpSaSI0ntEEYPOpbDhFTGWoVVoik0mgIAELVp7NVZNZb4hbIxgTDQAOFAx0UAIRHxgcVxkeHX9DFiYkCA8FCwIBE5sSCwwWLBZFk39/MIEVCgILCwUNnwYMBx0jGiZ9HRwvSB4emBENsrEFDhsZP0qSFaxmHTIaEQ6FCwkFAZhKI5IeFZAbHh8eBBQUBw0CDY3eM30cqhUaBAEHRAQTBOXwJHmGUOrggRCtCREq/KMRcIMvGAEAAGjQ4AGFQAs1hINmIQYDioUaXFxIg5mRGNdA5SogQ3LGRo4BUjBQMEFhS0GUzqBBRwABgWU3S1jQQ6/Czw0ECEwLqnGenisIDhiQStNmSz4b/5wLwCCAAgcBWLZklkGDmiIdDihYSzPX2FMxMHj4Ye/rpyvDSE5CgIaVCA4G7pr56c9bH6LzLCTxECECkQ0R0vWrIQmJiz+/CpsNt4/ChAMUplWwgMEEBkowMFgY14aEhg6f4/CDlpSIaiG2DxOsUcFznNCnCUQgwOGUFYfCijjrAOdAwjxJCQ8V0rMIxhkaLAgn4ALdcHLTcZfSCy1P4+F4Ib3Iy3T10w5HhF0nEQIAIfkECQYAHwAsAAAAACAAIAAABf/gJ46i9mVTAwDC0hCfhpF0LXIRgTDJ4A8LyqlSydhsBAYAYggsfBJJQejZIDqzoyhDebQKjAkgIRlIAJtPBcHGmmyaSKOwqDcmjqf54fl0NoAVHh4ZbyQWB3N0CwABBgBlCwEzHVceGB4dHX2HBBQGDgIJCY0bFA4PBxYxlR2FVQhFI1wMB1YOdA8wH4MjGkQWGRgVgByrIhtKDxQdEQoMEUZwGRmZHIBXRhWJAA0OBgSChloW19ibHwQODezdB1lasxUdHB2CRhHr7RAU0vGzFu4Jy7DhQAAGDxxMqPCvRrVB8wIisEKBAodxDU8E5MCmQgQKE7NlJKGh3EQr2xTwGDhwIALDkSXWIKi3YRuDAAEcBEDgb+SwetcqTGCgQIFOBBgzVgsoaOjNli9hnhiEoSoXAwYi1OQEM0OFekQIVYpFDMGxjCWtbABrxANHTxQInP3nVe1aWR4iHJgwYW8apR6+qrVgogKFvX0n8ExKQhihahxdicBAgO8EkBUs2Ov5pqQmDzLmcf1gofIEAoM2RIhl5GEhk5aoYmwWAcuaCKstDAOk++tEDhxkOZw3j0CO1YI66Ni0e+2GYFo0eEDwMccGDxasTCySfaZwLRmUGyfAITAbNtczbVaquaN5BAQIPKfas2EGC8Hua9L0/UgIACH5BAUGAB8ALAAAAAAgACAAAAX/4CeOo0cYDkMRTwE4wYFkZG1nBNMIS+FMgMFAklgoPLbkB7MJABbQxYMCkAiHDyRNKdpMKBNIodD7NRKStJHmwSgziEAjgIg0FonC4wBJCBMNGx8eHB1bJB4RCg0vBBYBeAIMEZBCAhMfGh0ICBUaNQiLAABzdRBzG0wOAgAKHR8WG5wbSCQ5DbikBhWytR8VCBw0msEdHRaHGl4Kp6QHvkpMnRgeHhU0TASyBgwKB69cIhgVHR4aGRUc1x0TBhEcdY7hJBkYGBkW8MJxDAYUEYbm1UBnbMMGDiYCMAigIACBQwI/oDNIsQIFBt0cOKAALaKHDgYRbKhwQEHDGA8j55LQQK6CSxMU/iHo4EYlCWoZcmb4WMFCT4g2qVWzYI2AUQIILNgUgY8cB1mbJhyY8GUD0HkZNonk1IHAgalfCXTECmwDSFobwEidkHIpwaeGKkSYGmFmTpX17FnrUOEeghXILBirGY5gT70YPsUqRygCAU+FgYnk6wHiOFkEIkSgJULDpxGeJ4o0e21lBQL/jCJoY81cJgwWkImeWRpRHc0EysWaeY/cQTcYNo0kTCKWY1ofEWirxkvktY/DlWjYXQH6LGS8DFKudrVGNWockHK6lh1u4qXBMfNuTrk71r0ciFqr7l5ECAA7' /></div>";
        $("#ex-favorite-box .span9").append(img);
    }
	
	function startLoading(){
		$("#loadingImg").css("display","");
	}
	
	function stopLoading(){
		$("#loadingImg").css("display","none");
	}

    function inject(vocabularyId){
        $(".note-user-box-tab").click();
        //添加标签
        var tabTitle = '最喜欢';
        $("#example-tab").append('<li><a class="ex-favorite-box-tab" href="#ex-favorite-box">'+tabTitle+'</a></li>');
        //添加标签下面的具体内容
        var wrapper = '<div class="tab-pane row" id="ex-favorite-box"><ol class="span9"></ol></div>';
        $(".tab-content").append(wrapper);
		initLoading();
		startLoading();
        $(".ex-favorite-box-tab").click();
        getMostFavorite(vocabularyId,function(list){$("#ex-favorite-box ol").append(list)});
    }
    

    /**
     * @brief 获得最喜欢的例句列表
     *
     * @return 最喜欢的例句html 
     */
    function getMostFavorite(vocabularyId,callBack){
        var list = [];
        $("#ex-defaults-box .like").each(function(){
            var patrn= /喜欢（(\d+)）/ig;
            match = patrn.exec($(this).text());
            if (match){
                list.push([match[1],$(this).parent().parent().parent().parent()]);
            }
        });

        $.ajax("http://www.shanbay.com/api/v1/example/?vocabulary_id="+vocabularyId).done(function(d){
            for(var index in d.objects) {
                var i = d.objects[index];
                var html = '<li class="row">'+
                            '<div class="span9"><div class="index pull-left"></div><div class="pull-left body">'+
                                '<div class="enex">'+i.first+'<span class="mid">'+i.mid+'</span>'+i.last+'</div>'+
                                '<div class="cnex">'+i.translation+'</div>'+
                                '<div class="edit-example-box"></div></div><div class="actions-wrap"><div class="actions hide btn-group pull-right">'+
                                    '<a class="like btn btn-mini" href="javascript:void(0)">喜欢（'+i.likes+'）</a>'+
                                    '<a class="unlike btn btn-mini" href="javascript:void(0)">不喜欢（'+i.unlikes+'）</a>'+
                                    '<a class="more hide btn btn-mini" href="javascript:void(0)">更多</a></div></div>'+
                            '</div>'+
                           '</li>';
                list.push([i.likes,$(html)]);
            }
            //排序
            list.sort(function(a,b){return b[0] - a[0];});
            
            var returnStr = "";
            var showCount = 5;
            if(list.length < showCount) {
                showCount = list.length;
            }
            for (var i = 0; i < showCount; i += 1) {
                //alert(list[i][1].clone().children('.index').html());
                var s = $(list[i][1].clone());
                s.find(".index").text((i+1)+".")
                returnStr += $('<a>').append(s).html(); 
            };

            callBack(returnStr);
			stopLoading();
        });
    }
}
